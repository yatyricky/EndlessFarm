function InitGlobals()
end

function CreateAllItems()
    local itemID
    BlzCreateItemWithSkin(FourCC("ckng"), 199.3, -390.7, FourCC("ckng"))
    BlzCreateItemWithSkin(FourCC("prvt"), 179.3, -205.3, FourCC("prvt"))
end

function InitCustomPlayerSlots()
    SetPlayerStartLocation(Player(0), 0)
    SetPlayerColor(Player(0), ConvertPlayerColor(0))
    SetPlayerRacePreference(Player(0), RACE_PREF_HUMAN)
    SetPlayerRaceSelectable(Player(0), true)
    SetPlayerController(Player(0), MAP_CONTROL_USER)
end

function InitCustomTeams()
    SetPlayerTeam(Player(0), 0)
end

function main()
    SetCameraBounds(-3328.0 + GetCameraMargin(CAMERA_MARGIN_LEFT), -3584.0 + GetCameraMargin(CAMERA_MARGIN_BOTTOM), 3328.0 - GetCameraMargin(CAMERA_MARGIN_RIGHT), 3072.0 - GetCameraMargin(CAMERA_MARGIN_TOP), -3328.0 + GetCameraMargin(CAMERA_MARGIN_LEFT), 3072.0 - GetCameraMargin(CAMERA_MARGIN_TOP), 3328.0 - GetCameraMargin(CAMERA_MARGIN_RIGHT), -3584.0 + GetCameraMargin(CAMERA_MARGIN_BOTTOM))
    SetDayNightModels("Environment\\DNC\\DNCLordaeron\\DNCLordaeronTerrain\\DNCLordaeronTerrain.mdl", "Environment\\DNC\\DNCLordaeron\\DNCLordaeronUnit\\DNCLordaeronUnit.mdl")
    NewSoundEnvironment("Default")
    SetAmbientDaySound("LordaeronSummerDay")
    SetAmbientNightSound("LordaeronSummerNight")
    SetMapMusic("Music", true, 0)
    CreateAllItems()
    InitBlizzard()
    InitGlobals()
--nef-inject
local a={}local b=function(c)local d=a[c]if d~=nil then if not d.inited then d.cached=d.loader()d.inited=true end;return d.cached else error("module not found")return nil end end;a["Main"]={inited=false,cached=false,loader=function(...)b("Game/Configs/Const")b("Math/MathExt")b("GlobalFuncs")b("TableExt")b("Logger")b("Time").Init()b("Game/Engine").Start()end}a["Game/Configs/Const"]={inited=false,cached=false,loader=function(...)ATT_STR=1;ATT_AGI=2;ATT_INT=3;ATT_NON=4;CAREER_TYPE_TANK=32;CAREER_TYPE_HEALER=2;CAREER_TYPE_DPS=4;CAREER_TYPE_MINION=64;CAREER_TYPE_BOSS=8;CAREER_TYPE_CREEP=16;UTID_BLADE_MASTER=1331850337 end}a["Math/MathExt"]={inited=false,cached=false,loader=function(...)math.clamp=function(e,f,g)return math.min(math.max(e,f),g)end end}a["GlobalFuncs"]={inited=false,cached=false,loader=function(...)function clone(h)local i={}local function j(h)if type(h)~="table"then return h elseif i[h]then return i[h]end;local k={}i[h]=k;for l,m in pairs(h)do k[j(l)]=j(m)end;return setmetatable(k,getmetatable(h))end;return j(h)end;function class(n,o)local p=type(o)local q;if p~="function"and p~="table"then p=nil;o=nil end;if p=="function"or o and o.__ctype==1 then q={}if p=="table"then for r,s in pairs(o)do q[r]=s end;q.__create=o.__create;q.super=o else q.__create=o end;q.Constructor=function()end;q.__cname=n;q.__ctype=1;function q.New(...)local t=q.__create(...)for r,s in pairs(q)do t[r]=s end;t.class=q;t:Constructor(...)return t end else if o then q=clone(o)q.super=o else q={Constructor=function()end}end;q.__cname=n;q.__ctype=2;q.__index=q;function q.New(...)local t=setmetatable({},q)t.class=q;t:Constructor(...)return t end end;return q end;function bindfunc(u,v)return function(...)return u(v,...)end end end}a["TableExt"]={inited=false,cached=false,loader=function(...)function t_join(w,x,y)local z=""for A=1,#w do if y then z=z..y(w[A])else z=z..tostring(w[A])end;if A<#w then z=z..x end end;return z end;function t_isempty(w)return next(w)==nil end;function t_tojson(w,B)local function C(D)local E=type(D)if E=="string"then return'"'..D..'"'end;local F=tostring(D)if E=="function"then return'"'..F..'"'else return F end end;local function G(w,H,I,J)if type(w)~="table"then return C(w)end;J=J or{}local K=tostring(w)if J[K]then return'"_ ref '..K..'"'end;J[K]=true;local L="{"if H then L=L.."\n"end;local M=H or""local N=B or""local O=H and M..N or nil;local P=H and" "or""L=L..M..'"_ ":'..P..'"'..K..'"'for r,s in pairs(w)do if H then L=L..",\n"else L=L..","end;local Q;if type(r)=="number"then Q="_ "..r else Q=tostring(r)end;L=L..M..'"'..Q..'":'..P..G(s,O,H,J)end;if H then L=L.."\n"..(I or"")end;L=L.."}"return L end;return G(w,B)end;function t_query(R,S)S=S or{}local T=S.asList;local U=S.where;local V=S.select;local W=S.any;local X=S.all;local Y=V or W==nil and X==nil;local Z={}local l;local m;for r,s in pairs(R)do if U then if U(r,s)then if Y then if T then l=#Z+1 else l=r end;if V then m=V(r,s)else m=s end;Z[l]=m else if W then if W(r,s)then return true end elseif X then if not X(r,s)then return false end end end end else if Y then if T then l=#Z+1 else l=r end;if V then m=V(r,s)else m=s end;Z[l]=m else if W then if W(r,s)then return true end elseif X then if not X(r,s)then return false end end end end end;if Y then return Z else if W then return false elseif X then return true end end end;t_insert=table.insert end}a["Logger"]={inited=false,cached=false,loader=function(...)local _=b("Time")function log(...)local L=""for a0,s in pairs({...})do L=L.." "..t_tojson(s)end;print(_.GetTime().."[I]:"..L)end;function logwarn(...)print(_.GetTime().."[W]:",...)end;function logerror(...)print(_.GetTime().."[E]:",...)end end}a["Time"]={inited=false,cached=false,loader=function(...)local _={}local a1=100;function _.Init()_.clock=CreateTimer()_.time=0;TimerStart(_.clock,a1,true,function()_.time=_.time+a1 end)end;function _.GetTime()return _.time+TimerGetElapsed(_.clock)end;function _.GetTimeHMS()local a2=_.GetTime()local w={}local a3=math.floor(a2)a2=a2-a3;w.h=math.floor(a3/3600)a3=a3-w.h*3600;w.m=math.floor(a3/60)a3=a3-w.m*60;w.s=a3+a2;return w end;return _ end}a["Game/Engine"]={inited=false,cached=false,loader=function(...)local _=b("Time")local a4=b("Timer")local a5=b("Game/World")local a6={}function a6.Start()local a7=a5.New()a7:Add(b("Game/Systems/TestSystem").New())a7:Add(b("Game/Systems/CreateUnitSystem").New())a7:Add(b("Game/Systems/SpellCastSystem").New())a7:Awake()a7:Start()local a8=_.GetTime()local a9=a4.New(0.01666667,-1,function()local aa=_.GetTime()a7:Update(aa-a8)a8=aa end):Start()end;return a6 end}a["Timer"]={inited=false,cached=false,loader=function(...)local a4=class("Timer")a4.refs={}function a4.Update()local ab=a4.refs[GetExpiredTimer()]if ab.this then ab.callback(ab.this)else ab.callback()end;ab.cloop=ab.cloop-1;if ab.cloop<=0 then a4.Destroy(ab)end end;function a4:Constructor(ac,ad,ae,ab)self.interval=ac;self.loop=ad;self.cloop=self.loop;self.callback=ae;self.this=ab;self.nTimer=CreateTimer()a4.refs[self.nTimer]=self end;function a4:Start()TimerStart(self.nTimer,self.interval,true,a4.Update)return self end;function a4:Extend(m,af)af=af or false;local z=m;if not af then z=math.floor(m/self.interval)end;self.cloop=self.cloop+z end;function a4:Pause()end;function a4:Resume()end;function a4:Destroy()a4.refs[self.nTimer]=nil;DestroyTimer(self.nTimer)end;return a4 end}a["Game/World"]={inited=false,cached=false,loader=function(...)local a5=class("World")function a5:Constructor()self:Init()end;function a5:Init()self.systems={}self.time=0 end;function a5:Add(ag)t_insert(self.systems,ag)end;function a5:Awake()for a0,s in pairs(self.systems)do s:Awake()end end;function a5:Start()for a0,s in pairs(self.systems)do s:Start()end end;function a5:Update(ah)self.time=self.time+ah;for a0,s in pairs(self.systems)do s:Update(ah)end end;return a5 end}a["Game/Systems/TestSystem"]={inited=false,cached=false,loader=function(...)local ai=b("Game/System")local a4=b("Timer")local aj=b("Math/Vector2")local ak=class("TestSystem",ai)function ak:Awake()end;function ak:Start()log("Test system is run")end;function ak:Update(al)end;return ak end}a["Game/System"]={inited=false,cached=false,loader=function(...)local ai=class("System")function ai:Awake()end;function ai:Start()end;function ai:Update(ah)end;return ai end}a["Math/Vector2"]={inited=false,cached=false,loader=function(...)local am=math.sqrt;local an=math.acos;local ao=math.max;local aj={}aj.__index=aj;aj.__div=function(ap,aq)return setmetatable({x=ap.x/aq,y=ap.y/aq},aj)end;aj.__mul=function(f,aq)if type(aq)=="number"then return setmetatable({x=f.x*aq,y=f.y*aq},aj)else return setmetatable({x=f*aq.x,y=f*aq.y},aj)end end;aj.__add=function(f,g)return setmetatable({x=f.x+g.x,y=f.y+g.y},aj)end;aj.__sub=function(f,g)return setmetatable({x=f.x-g.x,y=f.y-g.y},aj)end;aj.__unm=function(s)return setmetatable({x=-s.x,y=-s.y},aj)end;aj.__eq=function(f,g)return(f.x-g.x)^2+(f.y-g.y)^2<9.999999e-11 end;function aj.New(ar,as)return setmetatable({x=ar or 0,y=as or 0},aj)end;function aj:ToString()return string.format("(%f,%f)",self.x,self.y)end;function aj.Normalize(s)local ar=s.x;local as=s.y;local at=am(ar*ar+as*as)if at>0.00000001 then ar=ar/at;as=as/at else ar=0;as=0 end;return setmetatable({x=ar,y=as},aj)end;function aj.Dot(au,av)return au.x*av.x+au.y*av.y end;function aj.Angle(aw,E)local ax,ay=aw.x,aw.y;local aq=am(ax*ax+ay*ay)if aq>0.00000001 then ax=ax/aq;ay=ay/aq else ax,ay=0,0 end;local az,aA=E.x,E.y;aq=am(az*az+aA*aA)if aq>0.00000001 then az=az/aq;aA=aA/aq else az,aA=0,0 end;aq=ax*az+ay*aA;if aq<-1 then aq=-1 elseif aq>1 then aq=1 end;return an(aq)*57.29578 end;function aj.Magnitude(s)return am(s.x*s.x+s.y*s.y)end;function aj.Reflect(aB,aC)local aD=aB.x;local aE=aB.y;local aF=aC.x;local aG=aC.y;local aH=-2*(aD*aF+aE*aG)return setmetatable({x=aH*aF+aD,y=aH*aG+aE},aj)end;function aj.Distance(f,g)return am((f.x-g.x)^2+(f.y-g.y)^2)end;function aj.Lerp(f,g,w)if w<0 then w=0 elseif w>1 then w=1 end;return setmetatable({x=f.x+(g.x-f.x)*w,y=f.y+(g.y-f.y)*w},aj)end;function aj.LerpUnclamped(f,g,w)return setmetatable({x=f.x+(g.x-f.x)*w,y=f.y+(g.y-f.y)*w},aj)end;function aj.MoveTowards(aI,aJ,aK)local aL=aI.x;local aM=aI.y;local ar=aJ.x-aL;local as=aJ.y-aM;local aH=ar*ar+as*as;if aH>aK*aK and aH~=0 then aH=aK/am(aH)return setmetatable({x=aL+ar*aH,y=aM+as*aH},aj)end;return setmetatable({x=aJ.x,y=aJ.y},aj)end;function aj.ClampMagnitude(s,aN)local ar=s.x;local as=s.y;local aO=ar*ar+as*as;if aO>aN*aN then local aP=aN/am(aO)ar=ar*aP;as=as*aP;return setmetatable({x=ar,y=as},aj)end;return setmetatable({x=ar,y=as},aj)end;function aj.Max(f,g)return setmetatable({x=math.max(f.x,g.x),y=math.max(f.y,g.y)},aj)end;function aj.Min(f,g)return setmetatable({x=math.min(f.x,g.x),y=math.min(f.y,g.y)},aj)end;function aj.Scale(f,g)return setmetatable({x=f.x*g.x,y=f.y*g.y},aj)end;function aj:Set(ar,as)self.x=ar or 0;self.y=as or 0;return self end;function aj:Clone()return setmetatable({x=self.x,y=self.y},aj)end;function aj:Div(aq)self.x=self.x/aq;self.y=self.y/aq;return self end;function aj:Mul(aq)self.x=self.x*aq;self.y=self.y*aq;return self end;function aj:Add(g)self.x=self.x+g.x;self.y=self.y+g.y;return self end;function aj:Sub(g)self.x=self.x-g.x;self.y=self.y-g.y;return self end;function aj:SetNormalize()local at=am(self.x*self.x+self.y*self.y)if at>0.00000001 then self.x=self.x/at;self.y=self.y/at else self.x=0;self.y=0 end;return self end;function aj:SqrMagnitude()return self.x*self.x+self.y*self.y end;return aj end}a["Game/Systems/CreateUnitSystem"]={inited=false,cached=false,loader=function(...)local ai=b("Game/System")local aQ=b("Game/Managers/UnitManager")local aj=b("Math/Vector2")local a4=b("Timer")local aR=class("CreateUnitSystem",ai)function aR:Awake()end;function aR:Start()log("CreateUnitSystem system started")local aS=aQ.CreateUnit(Player(0),UTID_BLADE_MASTER)log("maxhp",BlzGetUnitMaxHP(aS.n_unit))local a9=a4.New(5,1,function()log("set hp")end):Start()end;function aR:Update(al)end;return aR end}a["Game/Managers/UnitManager"]={inited=false,cached=false,loader=function(...)local aj=b("Math/Vector2")local aT=b("Game/GameObjects/Unit")local aU=b("Game/GameObjects/UnitAttr")local aQ={}function aQ.CreateUnit(aV,aW,aX,aY)aX=aX or aj.New()aY=aY or 0;local aS=CreateUnit(aV,aW,aX.x,aX.y,aY)return aT.New(aW,aS)end;return aQ end}a["Game/GameObjects/Unit"]={inited=false,cached=false,loader=function(...)local aZ=b("Game/Configs/UnitConfig")local aU=b("Game/GameObjects/UnitAttr")local aT=class("Unit")function aT:Constructor(aW,a_)self.n_unit=a_;self.config=aZ.ById[aW]self.attrs={}self.attrGet={}self.attrSet={}self.attrRet={}self:_InitAttribute(aU.PhyxPower,nil,function(m)end,function()local b0=self.config;local b1=self.attrs[aU.PhyxPower]+math.random(b0.atk1,b0.atk2)return b1+self:GetMainAttrValue()end)self:_InitAttribute(aU.SpellPower,nil,nil,function()return self.attrs[aU.SpellPower]+GetHeroInt(self.n_unit,true)end)self:_InitAttribute(aU.PhyxCrit,nil,nil,function()local Z=self.attrs[aU.PhyxCrit]+GetHeroAgi(self.n_unit,true)*0.001;return math.min(Z,1)end)self:_InitAttribute(aU.SpellCrit,nil,nil,function()local Z=self.attrs[aU.SpellCrit]+GetHeroInt(self.n_unit,true)*0.0015;return math.min(Z,1)end)self:_InitAttribute(aU.PhyxSpeed,nil,function(m)end,nil)self:_InitAttribute(aU.SpellCDR,nil,function()end,nil)self:_InitAttribute(aU.AttackRate,nil,nil,function()return math.clamp(self.attrs[aU.AttackRate],0.25,1)end)self:_InitAttribute(aU.DamageDealt,nil,nil,function()return math.max(self.attrs[aU.DamageDealt],0)end)self:_InitAttribute(aU.ParryRate,nil,nil,function()local Z=self.attrs[aU.ParryRate]+GetHeroStr(self.n_unit,true)*0.002;return math.min(Z,0.75)end)self:_InitAttribute(aU.DodgeRate,nil,nil,function()local Z=self.attrs[aU.DodgeRate]+GetHeroAgi(self.n_unit,true)*0.002;return math.min(Z,0.75)end)self:_InitAttribute(aU.PhyxTaken,nil,nil,function()local Z=100-self.attrs[aU.PhyxTaken]-self.config.def;return math.max(Z,0)/100 end)self:_InitAttribute(aU.SpellTaken,nil,nil,function()return math.max(self.attrs[aU.SpellTaken],0)end)self:_InitAttribute(aU.PhyxCritTaken,nil,nil,nil)self:_InitAttribute(aU.SpellCritTaken,nil,nil,nil)self:_InitAttribute(aU.DamageTaken,nil,function()end,function()return math.max(self.attrs[aU.DamageTaken],0)end)self:_InitAttribute(aU.Strength,function()return GetHeroStr(self.n_unit,true)end,function(m)end,nil)self:_InitAttribute(aU.Agility,function()return GetHeroAgi(self.n_unit,true)end,function(m)end,nil)self:_InitAttribute(aU.Intelligence,function()return GetHeroInt(self.n_unit,true)end,function(m)end,nil)self:_InitAttribute(aU.Life,function()return GetUnitState(self.n_unit,UNIT_STATE_MAX_LIFE)end,function(m)end,nil)self:_InitAttribute(aU.Mana,function()return GetUnitState(self.n_unit,UNIT_STATE_MAX_MANA)end,function(m)end,nil)self:_InitAttribute(aU.LifeRegen,nil,nil,nil)self:_InitAttribute(aU.ManaRegen,nil,nil,function()local Z=self.attrs[aU.ManaRegen]+GetHeroInt(self.n_unit,true)*0.03;if self.config.mainAtt==ATT_INT then Z=Z+6.5 else Z=Z*0.25 end;return Z end)self:_InitAttribute(aU.Speed,function()return GetUnitMoveSpeed(self.n_unit)end,function(m)end,nil)self:_InitAttribute(aU.Absorb,nil,nil,nil)self:_InitAttribute(aU.LifeLeech,nil,nil,nil)self:_InitAttribute(aU.ManaLeech,nil,nil,nil)self:_InitWithConfig()end;function aT:_InitAttribute(b2,b3,b4,b5,b6)self.attrs[b2]=0;b3=b3 or function()return self.attrs[b2]end;b4=b4 or function(m)self.attrs[b2]=m end;b5=b5 or b3;b6=b6 or function(b7,b8)logwarn("modder unimplemented "..b2)end;self.attrGet=b3;self.attrSet=b4;self.attrRet=b5 end;function aT:_InitWithConfig()end;function aT:GetAttr(b2)return self.attrGet[b2]()end;function aT:SetAttr(b2,m)self.attrSet[b2](m)end;function aT:ReturnAttr(b2)self.attrRet[b2]()end;function aT:GetMainAttrValue()if self.unitConfig.mainAtt==ATT_STR then return GetHeroStr(self.n_unit,true)elseif self.unitConfig.mainAttribute==ATT_AGI then return GetHeroAgi(self.n_unit,true)elseif self.unitConfig.mainAttribute==ATT_INT then return GetHeroInt(self.n_unit,true)end;return 0 end;function aT:ReturnPhyxPowerMax()return self.config.atk2+self:GetMainAttrValue()end;return aT end}a["Game/Configs/UnitConfig"]={inited=false,cached=false,loader=function(...)local aZ={}aZ.DB={{utid=UTID_BLADE_MASTER,mainAtt=ATT_STR,hp=3000,mp=200,atk1=50,atk2=100,def=10,dodge=0.25,parry=0.25,staken=1,pcrit=0.1,career=CAREER_TYPE_DPS}}local b9={}for a0,s in pairs(aZ.DB)do b9[s.utid]=s end;aZ.ById=setmetatable(b9,{__index=function(w,r)local s=rawget(w,r)if s then return s else logerror("id not found "..r)end end})return aZ end}a["Game/GameObjects/UnitAttr"]={inited=false,cached=false,loader=function(...)local ba=b("Common/IDGenerator")local bb=ba.New()local aU={PowerMin=bb:Next(),PowerMax=bb:Next(),CritRate=bb:Next(),AttackSpeed=bb:Next(),AttackRate=bb:Next(),CDR=bb:Next(),DamageDealt=bb:Next(),DodgeRate=bb:Next(),PhyxDefP=bb:Next(),SpellDefP=bb:Next(),PhyxCritTaken=bb:Next(),SpellCritTaken=bb:Next(),DamageTaken=bb:Next(),Strength=bb:Next(),Agility=bb:Next(),Intelligence=bb:Next(),Life=bb:Next(),Mana=bb:Next(),LifeRegen=bb:Next(),ManaRegen=bb:Next(),Speed=bb:Next(),Absorb=bb:Next(),LifeLeech=bb:Next(),ManaLeech=bb:Next()}return aU end}a["Common/IDGenerator"]={inited=false,cached=false,loader=function(...)local ba=class("IDGenerator")function ba:Constructor(bc)self.start=bc or 0 end;function ba:Next()self.start=self.start+1;return self.start end;return ba end}a["Game/Systems/SpellCastSystem"]={inited=false,cached=false,loader=function(...)local ai=b("Game/System")local bd=b("Game/EventCenter")local be=class("SpellCastSystem",ai)function be:Awake()bd.SpellCast:AddListener(self.OnSpellCast,self)end;function be:OnSpellCast(bf,bg)log(GetUnitName(bf).." cast "..bg)end;return be end}a["Game/EventCenter"]={inited=false,cached=false,loader=function(...)local bh=b("Event")local bi=0;local function bj()bi=bi+1;return bi end;return{SpellCast=bh.New(bj())}end}a["Event"]={inited=false,cached=false,loader=function(...)local bh=class("Event")function bh:Constructor(bi)self.id=bi;self.handlers={}end;function bh:AddListener(bk,v)if self.handlers[bk]then logwarn("double AddListener ",self.id,bk,v)end;self.handlers[bk]=v or false end;function bh:RemoveListener(bk)if bk then if not self.handlers[bk]then logwarn("no hander in event ",self.id,bk)end;self.handlers[bk]=nil else self.handlers={}end end;function bh:Broadcast(...)local bl=0;for bk,v in pairs(self.handlers)do if v then bk(v,...)else bk(...)end;bl=bl+1 end;if bl==0 then log("event "..self.id.." has no listener")end end;return bh end}a["Main"].loader()
--nef-inject-end
end

function config()
    SetMapName("TRIGSTR_001")
    SetMapDescription("TRIGSTR_003")
    SetPlayers(1)
    SetTeams(1)
    SetGamePlacement(MAP_PLACEMENT_USE_MAP_SETTINGS)
    DefineStartLocation(0, 576.0, -576.0)
    InitCustomPlayerSlots()
    SetPlayerSlotAvailable(Player(0), MAP_CONTROL_USER)
    InitGenericPlayerSlots()
end

