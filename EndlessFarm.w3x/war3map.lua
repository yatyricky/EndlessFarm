function InitGlobals()
end

function CreateAllItems()
    local itemID
    BlzCreateItemWithSkin(FourCC("ckng"), 199.3, -390.7, FourCC("ckng"))
    BlzCreateItemWithSkin(FourCC("pmna"), -6.5, -366.0, FourCC("pmna"))
    BlzCreateItemWithSkin(FourCC("prvt"), 179.3, -205.3, FourCC("prvt"))
end

function InitCustomPlayerSlots()
    SetPlayerStartLocation(Player(0), 0)
    SetPlayerColor(Player(0), ConvertPlayerColor(0))
    SetPlayerRacePreference(Player(0), RACE_PREF_HUMAN)
    SetPlayerRaceSelectable(Player(0), true)
    SetPlayerController(Player(0), MAP_CONTROL_USER)
end

function InitCustomTeams()
    SetPlayerTeam(Player(0), 0)
end

function main()
    SetCameraBounds(-3328.0 + GetCameraMargin(CAMERA_MARGIN_LEFT), -3584.0 + GetCameraMargin(CAMERA_MARGIN_BOTTOM), 3328.0 - GetCameraMargin(CAMERA_MARGIN_RIGHT), 3072.0 - GetCameraMargin(CAMERA_MARGIN_TOP), -3328.0 + GetCameraMargin(CAMERA_MARGIN_LEFT), 3072.0 - GetCameraMargin(CAMERA_MARGIN_TOP), 3328.0 - GetCameraMargin(CAMERA_MARGIN_RIGHT), -3584.0 + GetCameraMargin(CAMERA_MARGIN_BOTTOM))
    SetDayNightModels("Environment\\DNC\\DNCLordaeron\\DNCLordaeronTerrain\\DNCLordaeronTerrain.mdl", "Environment\\DNC\\DNCLordaeron\\DNCLordaeronUnit\\DNCLordaeronUnit.mdl")
    NewSoundEnvironment("Default")
    SetAmbientDaySound("LordaeronSummerDay")
    SetAmbientNightSound("LordaeronSummerNight")
    SetMapMusic("Music", true, 0)
    CreateAllItems()
    InitBlizzard()
    InitGlobals()
--nef-inject
local a={}local b=function(c)local d=a[c]if d~=nil then if not d.inited then d.cached=d.loader()d.inited=true end;return d.cached else error("module not found")return nil end end;a["Main"]={inited=false,cached=false,loader=function(...)b("Extension")b("Game/Configs/Const")b("GlobalFuncs")b("Logger")b("Time").Init()b("Locale/Locale").Init("EN")b("Game/Engine").Start()end}a["Extension"]={inited=false,cached=false,loader=function(...)n_floor=math.floor;n_min=math.min;n_max=math.max;function n_clamp(e,f,g)return n_min(n_max(e,f),g)end;function n_round(e)return n_floor(e+0.5)end;function t_join(h,i,j)local k=""for l=1,#h do if j then k=k..j(h[l])else k=k..tostring(h[l])end;if l<#h then k=k..i end end;return k end;function t_isempty(h)return next(h)==nil end;function t_tojson(h,m)local function n(o)local p=type(o)if p=="string"then return'"'..o..'"'end;local q=tostring(o)if p=="function"then return'"'..q..'"'else return q end end;local function r(h,s,t,u)if type(h)~="table"then return n(h)end;u=u or{}local v=tostring(h)if u[v]then return'"_ ref '..v..'"'end;u[v]=true;local w="{"if s then w=w.."\n"end;local x=s or""local y=m or""local z=s and x..y or nil;local A=s and" "or""w=w..x..'"_ ":'..A..'"'..v..'"'for B,C in pairs(h)do if s then w=w..",\n"else w=w..","end;local D;if type(B)=="number"then D="_ "..B else D=tostring(B)end;w=w..x..'"'..D..'":'..A..r(C,z,s,u)end;if s then w=w.."\n"..(t or"")end;w=w.."}"return w end;return r(h,m)end;function t_query(E,F)F=F or{}local G=F.select;local H=F.where;local I=F.any;local J=F.all;local K=F.sort;local L=F.asList or K~=nil;local M=nil;local function N(E)local O={v=E,l=nil,r=nil}if M==nil then M=O else local P=M;local Q;local R=true;while P~=nil do Q=P;if K(E,P.v)then P=P.l;R=true else P=P.r;R=false end end;if R then Q.l=O else Q.r=O end end end;local S=G or I==nil and J==nil;local T={}local U;local V;for B,C in pairs(E)do if H then if H(B,C)then if S then if L then U=#T+1 else U=B end;if G then V=G(B,C)else V=C end;if K then N(V)end;T[U]=V else if I then if I(B,C)then return true end elseif J then if not J(B,C)then return false end end end end else if S then if L then U=#T+1 else U=B end;if G then V=G(B,C)else V=C end;if K then N(V)end;T[U]=V else if I then if I(B,C)then return true end elseif J then if not J(B,C)then return false end end end end end;if S then if K then local W={}local function X(Y)if Y==nil then return end;X(Y.l)W[#W+1]=Y.v;X(Y.r)end;X(M)return W else return T end else if I then return false elseif J then return true end end end;t_insert=table.insert;function s_split(v,Z)if Z==nil then Z="%s"end;local h={}for v in string.gmatch(v,"([^"..Z.."]+)")do t_insert(h,v)end;return h end end}a["Game/Configs/Const"]={inited=false,cached=false,loader=function(...)ATT_STR=1;ATT_AGI=2;ATT_INT=3;ATT_NON=4;CAREER_TYPE_TANK=32;CAREER_TYPE_HEALER=2;CAREER_TYPE_DPS=4;CAREER_TYPE_MINION=64;CAREER_TYPE_BOSS=8;CAREER_TYPE_CREEP=16;PLAYER_AID={{Q=(1093681456),W=(1093681457),E=(1093681458),R=(1093681459),D=(1093681460),F=(1093681460)}}UTID_BLADE_MASTER=(1331850337)UTID_PALADIN=(1215327329)UTID_DARK_RANGER=(1315074670)UTID_DEMON_HUNTER=(1164207469)UTID_ARCHMAGE=(1214931305)UTID_WARLOCK=(1332178020)end}a["GlobalFuncs"]={inited=false,cached=false,loader=function(...)function clone(_)local a0={}local function a1(_)if type(_)~="table"then return _ elseif a0[_]then return a0[_]end;local a2={}a0[_]=a2;for U,V in pairs(_)do a2[a1(U)]=a1(V)end;return setmetatable(a2,getmetatable(_))end;return a1(_)end;function class(a3,a4)local a5=type(a4)local a6;if a5~="function"and a5~="table"then a5=nil;a4=nil end;if a5=="function"or a4 and a4.__ctype==1 then a6={}if a5=="table"then for B,C in pairs(a4)do a6[B]=C end;a6.__create=a4.__create;a6.super=a4 else a6.__create=a4 end;a6.Constructor=function()end;a6.__cname=a3;a6.__ctype=1;function a6.New(...)local a7=a6.__create(...)for B,C in pairs(a6)do a7[B]=C end;a7.class=a6;a7:Constructor(...)return a7 end else if a4 then a6=clone(a4)a6.super=a4 else a6={Constructor=function()end}end;a6.__cname=a3;a6.__ctype=2;a6.__index=a6;function a6.New(...)local a7=setmetatable({},a6)a7.class=a6;a7:Constructor(...)return a7 end end;return a6 end;function bindfunc(a8,a9)return function(...)return a8(a9,...)end end end}a["Logger"]={inited=false,cached=false,loader=function(...)local aa=b("Time")local function ab(ac,...)local w=""for ad,C in pairs({...})do w=w.." "..t_tojson(C)end;BJDebugMsg(aa.GetTime().."["..ac.."]:"..w)end;function log(...)ab("I",...)end;function logwarn(...)ab("W",...)end;function logerror(...)ab("E",...)end end}a["Time"]={inited=false,cached=false,loader=function(...)local aa={}local ae=100;function aa.Init()aa.clock=CreateTimer()aa.time=0;TimerStart(aa.clock,ae,true,function()aa.time=aa.time+ae end)end;function aa.GetTime()return aa.time+TimerGetElapsed(aa.clock)end;function aa.GetTimeHMS()local af=aa.GetTime()local h={}local ag=math.floor(af)af=af-ag;h.h=math.floor(ag/3600)ag=ag-h.h*3600;h.m=math.floor(ag/60)ag=ag-h.m*60;h.s=ag+af;return h end;return aa end}a["Locale/Locale"]={inited=false,cached=false,loader=function(...)local ah={}function ah.Init(ai)if ai=="EN"then ah.lang=b("Locale/EN")elseif ai=="ZHCN"then ah.lang=b("Locale/EN")end end;function ah.S(U)local T=ah.lang[U]if T then return T else logerror("Lang undefined "..U)return""end end;return ah end}a["Locale/EN"]={inited=false,cached=false,loader=function(...)return{skill_cleave_name="Cleave",skill_cleave_desc="Damage all front enemies."}end}a["Game/Engine"]={inited=false,cached=false,loader=function(...)local aa=b("Time")local aj=b("Timer")local ak=b("Game/World")local al={}function al.Start()local am=ak.New()al.world=am;am:Add(b("Game/Systems/TestSystem").New())am:Add(b("Game/Systems/InputSystem").New())am:Add(b("Game/Systems/CreateUnitSystem").New())am:Awake()am:Start()local an=aj.New(0.01666667,-1,function()local ao=aa.GetTime()am:Update(ao-al.world.time)al.world.time=ao end):Start()end;return al end}a["Timer"]={inited=false,cached=false,loader=function(...)local aj=class("Timer")aj.refs={}function aj.Update()local ap=aj.refs[GetExpiredTimer()]if ap.this then ap.callback(ap.this)else ap.callback()end;ap.cloop=ap.cloop-1;if ap.cloop<=0 and ap.loop~=-1 then aj.Destroy(ap)end end;function aj:Constructor(aq,ar,as,ap)self.interval=aq;self.loop=ar;self.cloop=self.loop;self.callback=as;self.this=ap;self.nTimer=CreateTimer()aj.refs[self.nTimer]=self end;function aj:Start()TimerStart(self.nTimer,self.interval,true,aj.Update)return self end;function aj:Extend(V,at)at=at or false;local k=V;if not at then k=math.floor(V/self.interval)end;self.cloop=self.cloop+k end;function aj:Pause()end;function aj:Resume()end;function aj:Destroy()aj.refs[self.nTimer]=nil;DestroyTimer(self.nTimer)end;return aj end}a["Game/World"]={inited=false,cached=false,loader=function(...)local aa=b("Time")local ak=class("World")function ak:Constructor()self:Init()end;function ak:Init()self.systems={}self.time=aa.GetTime()self.frame=0 end;function ak:Add(au)t_insert(self.systems,au)end;function ak:Awake()for ad,C in pairs(self.systems)do C:Awake()end end;function ak:Start()for ad,C in pairs(self.systems)do C:Start()end end;function ak:Update(av)self.frame=self.frame+1;self.time=self.time+av;for ad,C in pairs(self.systems)do C:Update(av)end end;return ak end}a["Game/Systems/TestSystem"]={inited=false,cached=false,loader=function(...)local aw=b("Game/System")local aj=b("Timer")local ax=b("Math/Vector2")local ay=b("Game/EventCenter")local az=class("TestSystem",aw)function az:OnClickedZ()end;function az:Awake()ay.Keyboard:AddListener(self.OnClickedZ,self)end;function az:Start()log("Test system is run")end;function az:Update(aA)end;return az end}a["Game/System"]={inited=false,cached=false,loader=function(...)local aw=class("System")function aw:Awake()end;function aw:Start()end;function aw:Update(av)end;return aw end}a["Math/Vector2"]={inited=false,cached=false,loader=function(...)local aB=math.sqrt;local aC=math.acos;local aD=math.max;local ax={}ax.__index=ax;ax.__div=function(aE,aF)return setmetatable({x=aE.x/aF,y=aE.y/aF},ax)end;ax.__mul=function(f,aF)if type(aF)=="number"then return setmetatable({x=f.x*aF,y=f.y*aF},ax)else return setmetatable({x=f*aF.x,y=f*aF.y},ax)end end;ax.__add=function(f,g)return setmetatable({x=f.x+g.x,y=f.y+g.y},ax)end;ax.__sub=function(f,g)return setmetatable({x=f.x-g.x,y=f.y-g.y},ax)end;ax.__unm=function(C)return setmetatable({x=-C.x,y=-C.y},ax)end;ax.__eq=function(f,g)return(f.x-g.x)^2+(f.y-g.y)^2<9.999999e-11 end;function ax.New(aG,aH)return setmetatable({x=aG or 0,y=aH or 0},ax)end;function ax:ToString()return string.format("(%f,%f)",self.x,self.y)end;function ax.Normalize(C)local aG=C.x;local aH=C.y;local aI=aB(aG*aG+aH*aH)if aI>0.00000001 then aG=aG/aI;aH=aH/aI else aG=0;aH=0 end;return setmetatable({x=aG,y=aH},ax)end;function ax.Dot(aJ,aK)return aJ.x*aK.x+aJ.y*aK.y end;function ax.Angle(aL,p)local aM,aN=aL.x,aL.y;local aF=aB(aM*aM+aN*aN)if aF>0.00000001 then aM=aM/aF;aN=aN/aF else aM,aN=0,0 end;local aO,aP=p.x,p.y;aF=aB(aO*aO+aP*aP)if aF>0.00000001 then aO=aO/aF;aP=aP/aF else aO,aP=0,0 end;aF=aM*aO+aN*aP;if aF<-1 then aF=-1 elseif aF>1 then aF=1 end;return aC(aF)*57.29578 end;function ax.Magnitude(C)return aB(C.x*C.x+C.y*C.y)end;function ax.Reflect(aQ,aR)local aS=aQ.x;local aT=aQ.y;local aU=aR.x;local aV=aR.y;local aW=-2*(aS*aU+aT*aV)return setmetatable({x=aW*aU+aS,y=aW*aV+aT},ax)end;function ax.Distance(f,g)return aB((f.x-g.x)^2+(f.y-g.y)^2)end;function ax.Lerp(f,g,h)if h<0 then h=0 elseif h>1 then h=1 end;return setmetatable({x=f.x+(g.x-f.x)*h,y=f.y+(g.y-f.y)*h},ax)end;function ax.LerpUnclamped(f,g,h)return setmetatable({x=f.x+(g.x-f.x)*h,y=f.y+(g.y-f.y)*h},ax)end;function ax.MoveTowards(aX,aY,aZ)local a_=aX.x;local b0=aX.y;local aG=aY.x-a_;local aH=aY.y-b0;local aW=aG*aG+aH*aH;if aW>aZ*aZ and aW~=0 then aW=aZ/aB(aW)return setmetatable({x=a_+aG*aW,y=b0+aH*aW},ax)end;return setmetatable({x=aY.x,y=aY.y},ax)end;function ax.ClampMagnitude(C,b1)local aG=C.x;local aH=C.y;local b2=aG*aG+aH*aH;if b2>b1*b1 then local b3=b1/aB(b2)aG=aG*b3;aH=aH*b3;return setmetatable({x=aG,y=aH},ax)end;return setmetatable({x=aG,y=aH},ax)end;function ax.Max(f,g)return setmetatable({x=math.max(f.x,g.x),y=math.max(f.y,g.y)},ax)end;function ax.Min(f,g)return setmetatable({x=math.min(f.x,g.x),y=math.min(f.y,g.y)},ax)end;function ax.Scale(f,g)return setmetatable({x=f.x*g.x,y=f.y*g.y},ax)end;function ax:Set(aG,aH)self.x=aG or 0;self.y=aH or 0;return self end;function ax:Clone()return setmetatable({x=self.x,y=self.y},ax)end;function ax:Div(aF)self.x=self.x/aF;self.y=self.y/aF;return self end;function ax:Mul(aF)self.x=self.x*aF;self.y=self.y*aF;return self end;function ax:Add(g)self.x=self.x+g.x;self.y=self.y+g.y;return self end;function ax:Sub(g)self.x=self.x-g.x;self.y=self.y-g.y;return self end;function ax:SetNormalize()local aI=aB(self.x*self.x+self.y*self.y)if aI>0.00000001 then self.x=self.x/aI;self.y=self.y/aI else self.x=0;self.y=0 end;return self end;function ax:SqrMagnitude()return self.x*self.x+self.y*self.y end;return ax end}a["Game/EventCenter"]={inited=false,cached=false,loader=function(...)local b4=b("Common/IDGenerator")local b5=b("Event")local b6=b4.New()return{SpellCast=b5.New(b6:Next()),Keyboard=b5.New(b6:Next())}end}a["Common/IDGenerator"]={inited=false,cached=false,loader=function(...)local b4=class("IDGenerator")function b4:Constructor(b7)self.start=b7 or 0 end;function b4:Next()self.start=self.start+1;return self.start end;return b4 end}a["Event"]={inited=false,cached=false,loader=function(...)local b5=class("Event")function b5:Constructor(b6)self.id=b6;self.handlers={}end;function b5:AddListener(b8,a9)if self.handlers[b8]then logwarn("double AddListener ",self.id,b8,a9)end;self.handlers[b8]=a9 or false end;function b5:RemoveListener(b8)if b8 then if not self.handlers[b8]then logwarn("no hander in event ",self.id,b8)end;self.handlers[b8]=nil else self.handlers={}end end;function b5:Broadcast(...)local b9=0;for b8,a9 in pairs(self.handlers)do if a9 then b8(a9,...)else b8(...)end;b9=b9+1 end;if b9==0 then log("event "..self.id.." has no listener")end end;return b5 end}a["Game/Systems/InputSystem"]={inited=false,cached=false,loader=function(...)local aw=b("Game/System")local ay=b("Game/EventCenter")local ba=class("InputSystem",aw)function ba:Awake()local bb;bb=CreateTrigger()BlzTriggerRegisterPlayerKeyEvent(bb,Player(0),OSKEY_A,0,true)TriggerAddAction(bb,function()ay.Keyboard:Broadcast(OSKEY_A)end)bb=CreateTrigger()BlzTriggerRegisterPlayerKeyEvent(bb,Player(0),OSKEY_B,0,true)TriggerAddAction(bb,function()ay.Keyboard:Broadcast(OSKEY_B)end)bb=CreateTrigger()BlzTriggerRegisterPlayerKeyEvent(bb,Player(0),OSKEY_C,0,true)TriggerAddAction(bb,function()ay.Keyboard:Broadcast(OSKEY_C)end)bb=CreateTrigger()BlzTriggerRegisterPlayerKeyEvent(bb,Player(0),OSKEY_D,0,true)TriggerAddAction(bb,function()ay.Keyboard:Broadcast(OSKEY_D)end)bb=CreateTrigger()BlzTriggerRegisterPlayerKeyEvent(bb,Player(0),OSKEY_E,0,true)TriggerAddAction(bb,function()ay.Keyboard:Broadcast(OSKEY_E)end)bb=CreateTrigger()BlzTriggerRegisterPlayerKeyEvent(bb,Player(0),OSKEY_F,0,true)TriggerAddAction(bb,function()ay.Keyboard:Broadcast(OSKEY_F)end)bb=CreateTrigger()BlzTriggerRegisterPlayerKeyEvent(bb,Player(0),OSKEY_G,0,true)TriggerAddAction(bb,function()ay.Keyboard:Broadcast(OSKEY_G)end)bb=CreateTrigger()BlzTriggerRegisterPlayerKeyEvent(bb,Player(0),OSKEY_H,0,true)TriggerAddAction(bb,function()ay.Keyboard:Broadcast(OSKEY_H)end)bb=CreateTrigger()BlzTriggerRegisterPlayerKeyEvent(bb,Player(0),OSKEY_I,0,true)TriggerAddAction(bb,function()ay.Keyboard:Broadcast(OSKEY_I)end)bb=CreateTrigger()BlzTriggerRegisterPlayerKeyEvent(bb,Player(0),OSKEY_J,0,true)TriggerAddAction(bb,function()ay.Keyboard:Broadcast(OSKEY_J)end)bb=CreateTrigger()BlzTriggerRegisterPlayerKeyEvent(bb,Player(0),OSKEY_K,0,true)TriggerAddAction(bb,function()ay.Keyboard:Broadcast(OSKEY_K)end)bb=CreateTrigger()BlzTriggerRegisterPlayerKeyEvent(bb,Player(0),OSKEY_L,0,true)TriggerAddAction(bb,function()ay.Keyboard:Broadcast(OSKEY_L)end)bb=CreateTrigger()BlzTriggerRegisterPlayerKeyEvent(bb,Player(0),OSKEY_M,0,true)TriggerAddAction(bb,function()ay.Keyboard:Broadcast(OSKEY_M)end)bb=CreateTrigger()BlzTriggerRegisterPlayerKeyEvent(bb,Player(0),OSKEY_N,0,true)TriggerAddAction(bb,function()ay.Keyboard:Broadcast(OSKEY_N)end)bb=CreateTrigger()BlzTriggerRegisterPlayerKeyEvent(bb,Player(0),OSKEY_O,0,true)TriggerAddAction(bb,function()ay.Keyboard:Broadcast(OSKEY_O)end)bb=CreateTrigger()BlzTriggerRegisterPlayerKeyEvent(bb,Player(0),OSKEY_P,0,true)TriggerAddAction(bb,function()ay.Keyboard:Broadcast(OSKEY_P)end)bb=CreateTrigger()BlzTriggerRegisterPlayerKeyEvent(bb,Player(0),OSKEY_Q,0,true)TriggerAddAction(bb,function()ay.Keyboard:Broadcast(OSKEY_Q)end)bb=CreateTrigger()BlzTriggerRegisterPlayerKeyEvent(bb,Player(0),OSKEY_R,0,true)TriggerAddAction(bb,function()ay.Keyboard:Broadcast(OSKEY_R)end)bb=CreateTrigger()BlzTriggerRegisterPlayerKeyEvent(bb,Player(0),OSKEY_S,0,true)TriggerAddAction(bb,function()ay.Keyboard:Broadcast(OSKEY_S)end)bb=CreateTrigger()BlzTriggerRegisterPlayerKeyEvent(bb,Player(0),OSKEY_T,0,true)TriggerAddAction(bb,function()ay.Keyboard:Broadcast(OSKEY_T)end)bb=CreateTrigger()BlzTriggerRegisterPlayerKeyEvent(bb,Player(0),OSKEY_U,0,true)TriggerAddAction(bb,function()ay.Keyboard:Broadcast(OSKEY_U)end)bb=CreateTrigger()BlzTriggerRegisterPlayerKeyEvent(bb,Player(0),OSKEY_V,0,true)TriggerAddAction(bb,function()ay.Keyboard:Broadcast(OSKEY_V)end)bb=CreateTrigger()BlzTriggerRegisterPlayerKeyEvent(bb,Player(0),OSKEY_W,0,true)TriggerAddAction(bb,function()ay.Keyboard:Broadcast(OSKEY_W)end)bb=CreateTrigger()BlzTriggerRegisterPlayerKeyEvent(bb,Player(0),OSKEY_X,0,true)TriggerAddAction(bb,function()ay.Keyboard:Broadcast(OSKEY_X)end)bb=CreateTrigger()BlzTriggerRegisterPlayerKeyEvent(bb,Player(0),OSKEY_Y,0,true)TriggerAddAction(bb,function()ay.Keyboard:Broadcast(OSKEY_Y)end)bb=CreateTrigger()BlzTriggerRegisterPlayerKeyEvent(bb,Player(0),OSKEY_Z,0,true)TriggerAddAction(bb,function()ay.Keyboard:Broadcast(OSKEY_Z)end)end;return ba end}a["Game/Systems/CreateUnitSystem"]={inited=false,cached=false,loader=function(...)local aw=b("Game/System")local bc=b("Game/Managers/UnitManager")local ax=b("Math/Vector2")local aj=b("Timer")local ay=b("Game/EventCenter")local al=b("Game/Engine")local bd=b("Game/GameObjects/UnitAttr")local be=class("CreateUnitSystem",aw)function be:Awake()ay.Keyboard:AddListener(self.OnKeyboard,self)end;function be:Start()self.u=bc.CreateUnit(Player(0),UTID_BLADE_MASTER)self.c=0;bc.CreateUnit(Player(0),UTID_DEMON_HUNTER)bc.CreateUnit(Player(0),UTID_ARCHMAGE)end;function be:Update(aA)end;function be:OnKeyboard(U)if U==OSKEY_Q then log(self.u:ModAttr(bd.Strength,1))end;if U==OSKEY_W then log(self.u:ModAttr(bd.Strength,-1))end;if U==OSKEY_E then log(self.u:ModAttr(bd.Agility,1))end;if U==OSKEY_R then log(self.u:ModAttr(bd.Agility,-1))end;if U==OSKEY_T then log(self.u:ModAttr(bd.Intelligence,1))end;if U==OSKEY_Y then log(self.u:ModAttr(bd.Intelligence,-1))end;if U==OSKEY_U then log(self.u:ModAttr(bd.Life,1))end;if U==OSKEY_I then log(self.u:ModAttr(bd.Life,-1))end;if U==OSKEY_A then log(self.u:ModAttr(bd.Mana,1))end;if U==OSKEY_S then log(self.u:ModAttr(bd.Mana,-1))end;if U==OSKEY_P then log(self.u:ModAttr(bd.Power,1))end;if U==OSKEY_D then log(self.u:ModAttr(bd.PhyxResist,0.1))end end;return be end}a["Game/Managers/UnitManager"]={inited=false,cached=false,loader=function(...)local ax=b("Math/Vector2")local bf=b("Game/GameObjects/Unit")local bd=b("Game/GameObjects/UnitAttr")local bc={}function bc.CreateUnit(bg,bh,bi,bj)bi=bi or ax.New()bj=bj or 0;local bk=CreateUnit(bg,bh,bi.x,bi.y,bj)return bf.New(bh,bk)end;return bc end}a["Game/GameObjects/Unit"]={inited=false,cached=false,loader=function(...)local bl=b("Game/Configs/UnitConfig")local bd=b("Game/GameObjects/UnitAttr")local bm={[bd.Strength]={neg={},pos={(1093677104),(1093677105),(1093677106),(1093677107),(1093677108),(1093677109),(1093677110),(1093677111),(1093677112),(1093677113),(1093677121),(1093677122)}},[bd.Agility]={neg={},pos={(1093677390),(1093677389),(1093677388),(1093677387),(1093677386),(1093677385),(1093677384),(1093677383),(1093677126),(1093677125),(1093677124),(1093677123)}},[bd.Intelligence]={neg={},pos={(1093677392),(1093677393),(1093677394),(1093677395),(1093677396),(1093677397),(1093677398),(1093677399),(1093677400),(1093677401),(1093677391),(1093677402)}},[bd.Life]={neg={},pos={(1093677129),(1093677145),(1093677144),(1093677143),(1093677142),(1093677141),(1093677140),(1093677139),(1093677138),(1093677137),(1093677136),(1093677135),(1093677134),(1093677133),(1093677132),(1093677131),(1093677127),(1093677128),(1093677146),(1093677130)}},[bd.Mana]={neg={},pos={(1093677366),(1093677360),(1093677361),(1093677362),(1093677363),(1093677364),(1093677382),(1093677367),(1093677368),(1093677369),(1093677377),(1093677378),(1093677379),(1093677380),(1093677381),(1093677365)}}}local bf=class("Unit")function bf:Constructor(bh,bn)self.n_unit=bn;self.config=bl[bh]self.attrs={}self.attrGet={}self.attrSet={}self.attrRet={}self.attrMod={}self.skillList={}self:_InitAttribute(bd.Strength,nil,function(V)self:_SetNativeAttr(bd.Strength,V)self.attrs[bd.Strength]=V end,function(bo)log("get hero str",bo)return GetHeroStr(self.n_unit,not bo)end,function(V)self:_SetNativeAttr(bd.Strength,self.attrs[bd.Strength]+V)self.attrs[bd.Strength]=self.attrs[bd.Strength]+V end)self:_InitAttribute(bd.Agility,nil,function(V)self:_SetNativeAttr(bd.Agility,V)self.attrs[bd.Agility]=V end,function(bo)return GetHeroAgi(self.n_unit,not bo)end,function(V)self:_SetNativeAttr(bd.Agility,self.attrs[bd.Agility]+V)self.attrs[bd.Agility]=self.attrs[bd.Agility]+V end)self:_InitAttribute(bd.Intelligence,nil,function(V)self:_SetNativeAttr(bd.Intelligence,V)self.attrs[bd.Intelligence]=V end,function(bo)return GetHeroInt(self.n_unit,not bo)end,function(V)self:_SetNativeAttr(bd.Intelligence,self.attrs[bd.Intelligence]+V)self.attrs[bd.Intelligence]=self.attrs[bd.Intelligence]+V end)self:_InitAttribute(bd.Life,function(bo)if bo then return self.config.HP else return self.attrs[bd.Life]end end,function(V)self:_SetNativeAttr(bd.Life,V-1)self.attrs[bd.Life]=V-1 end,function(bo)if bo then return self.config.HP+GetHeroStr(self.n_unit,true)*10 else return GetUnitState(self.n_unit,UNIT_STATE_MAX_LIFE)end end,function(V)self:_SetNativeAttr(bd.Life,self.attrs[bd.Life]+V)self.attrs[bd.Life]=self.attrs[bd.Life]+V end)self:_InitAttribute(bd.Mana,function(bo)if bo then return self.config.MP else return self.attrs[bd.Mana]end end,function(V)self:_SetNativeAttr(bd.Mana,V)self.attrs[bd.Mana]=V end,function(bo)if bo then return self.config.MP+GetHeroInt(self.n_unit,true)*10 else return GetUnitState(self.n_unit,UNIT_STATE_MAX_MANA)end end,function(V)self:_SetNativeAttr(bd.Mana,self.attrs[bd.Mana]+V)self.attrs[bd.Mana]=self.attrs[bd.Mana]+V end)self:_InitAttribute(bd.Power,nil,function(V)self:_SetNativeAttr(bd.Power,V)self.attrs[bd.Power]=V end,function()local bp=self.config;local bq=self.attrs[bd.Power]+math.random(bp.ATK1,bp.ATK2)return bq+self:GetPrimaryAttrValue()end,function(V)self:_SetNativeAttr(bd.Power,self.attrs[bd.Power]+V)self.attrs[bd.Power]=self.attrs[bd.Power]+V end)self:_InitAttribute(bd.DamageDealt,nil,nil,function()return n_max(self.attrs[bd.DamageDealt],0)end,nil)self:_InitAttribute(bd.CritRate,nil,nil,function()return n_min(self.attrs[bd.CritRate],1)end)self:_InitAttribute(bd.AttackSpeed,nil,function(V)self:_SetNativeAttr(bd.AttackSpeed,n_round(V*100))self.attrs[bd.AttackSpeed]=V end,nil,function(V)self:_SetNativeAttr(bd.AttackSpeed,n_round((self.attrs[bd.AttackSpeed]+V)*100))self.attrs[bd.AttackSpeed]=self.attrs[bd.AttackSpeed]+V end)self:_InitAttribute(bd.AttackRate,nil,nil,function()return n_clamp(self.attrs[bd.AttackRate],0.25,1)end,nil)self:_InitAttribute(bd.CDR,nil,function()end,nil)self:_InitAttribute(bd.DodgeRate,nil,nil,function()local T=self.attrs[bd.DodgeRate]+GetHeroAgi(self.n_unit,true)*0.002;return n_min(T,0.75)end)self:_InitAttribute(bd.PhyxResist,function(bo)if bo then return self.config.Def else return self.config.Def+self.attrs[bd.PhyxResist]end end,function(V)self:_SetNativeAttr(bd.PhyxResist,n_round(V*100))self.attrs[bd.PhyxResist]=V end,nil,function(V)self:_SetNativeAttr(bd.PhyxResist,n_round((self.attrs[bd.PhyxResist]+V)*100))self.attrs[bd.PhyxResist]=self.attrs[bd.PhyxResist]+V end)self:_InitAttribute(bd.PhyxDef,nil,nil,nil,nil)self:_InitAttribute(bd.SpellResist,nil,nil,nil,nil)self:_InitAttribute(bd.SpellDef,nil,nil,nil,nil)self:_InitAttribute(bd.PhyxCritTaken,nil,nil,nil,nil)self:_InitAttribute(bd.SpellCritTaken,nil,nil,nil,nil)self:_InitAttribute(bd.DamageTaken,nil,nil,function()return n_max(self.attrs[bd.DamageTaken],0)end,nil)self:_InitAttribute(bd.LifeRegen,nil,nil,nil,nil)self:_InitAttribute(bd.ManaRegen,nil,nil,nil,nil)self:_InitAttribute(bd.Speed,function()return GetUnitMoveSpeed(self.n_unit)end,function(V)end,nil)self:_InitAttribute(bd.Absorb,nil,nil,nil)self:_InitAttribute(bd.LifeLeech,nil,nil,nil)self:_InitAttribute(bd.ManaLeech,nil,nil,nil)self:_InitWithConfig()end;function bf:_SetNativeAttr(br,V)if self.attrs[br]==V then return end;local bk=self.n_unit;local bs=bm[br]local bt=bs.neg;local bi=bs.pos;log("native set == ",br,V)V=n_clamp(V,2^#bt-1,2^#bi-1)local function bu(bv)for l=1,#bv do local bw=bv[l]if GetUnitAbilityLevel(bk,bw)>0 then UnitRemoveAbility(bk,bw)end end end;local function bx(bv,C)local by=1;for l=1,#bv do local bw=bv[l]local bz=BlzBitAnd(C,by)==by;local bA=GetUnitAbilityLevel(bk,bw)>0;if bz and not bA then UnitAddAbility(bk,bw)UnitMakeAbilityPermanent(bk,true,bw)end;if not bz and bA then UnitRemoveAbility(bk,bw)end;by=by*2 end end;if V==0 then bu(bt)bu(bi)else if V<0 then bu(bi)bx(bt,math.abs(V))else bu(bt)bx(bi,V)end end end;function bf:_InitAttribute(br,bB,bC,bD,bE)self.attrs[br]=0;bB=bB or function()return self.attrs[br]end;bC=bC or function(V)self.attrs[br]=V end;bD=bD or bB;bE=bE or function(V)bC(bB()+V)end;self.attrGet[br]=bB;self.attrSet[br]=bC;self.attrRet[br]=bD;self.attrMod[br]=bE end;function bf:_InitWithConfig()local bk=self.n_unit;local bp=self.config;SetHeroStr(bk,bp.Str,true)SetHeroAgi(bk,bp.Agi,true)SetHeroInt(bk,bp.Int,true)BlzSetUnitMaxMana(bk,bp.Int*10)self:SetAttr(bd.Mana,bp.MP)BlzSetUnitMaxHP(bk,1+bp.Str*10)self:SetAttr(bd.Life,bp.HP)BlzSetUnitBaseDamage(bk,bp.ATK1-1+self:GetPrimaryAttrValue(),0)BlzSetUnitDiceNumber(bk,1,0)BlzSetUnitDiceSides(bk,bp.ATK2-bp.ATK1+1,0)BlzSetUnitArmor(bk,n_round(bp.Def*100))end;function bf:GetAttr(br,...)return self.attrGet[br](...)end;function bf:SetAttr(br,V)self.attrSet[br](V)end;function bf:ReturnAttr(br,...)return self.attrRet[br](...)end;function bf:ModAttr(br,V)self.attrMod[br](V)end;function bf:GetPrimaryAttrValue()if self.config.PrimAtt==ATT_STR then return GetHeroStr(self.n_unit,true)elseif self.config.PrimAtt==ATT_AGI then return GetHeroAgi(self.n_unit,true)elseif self.config.PrimAtt==ATT_INT then return GetHeroInt(self.n_unit,true)end;return 0 end;function bf:ReturnPhyxPowerMax()return self.config.ATK2+self:GetPrimaryAttrValue()end;return bf end}a["Game/Configs/UnitConfig"]={inited=false,cached=false,loader=function(...)local bl={[UTID_BLADE_MASTER]={UTID=UTID_BLADE_MASTER,PrimAtt=ATT_STR,Str=15,Agi=10,Int=5,HP=700,MP=50,ATK1=50,ATK2=100,Def=0.1,SDef=1,Dodge=0.25,Crit=0.1,Career=CAREER_TYPE_DPS},[UTID_DEMON_HUNTER]={UTID=UTID_DEMON_HUNTER,PrimAtt=ATT_AGI,Str=9,Agi=12,Int=9,HP=600,MP=300,ATK1=30,ATK2=100,Def=0.15,SDef=1,Dodge=0.25,Crit=0.1,Career=CAREER_TYPE_DPS},[UTID_ARCHMAGE]={UTID=UTID_ARCHMAGE,PrimAtt=ATT_INT,Str=7,Agi=5,Int=18,HP=600,MP=600,ATK1=20,ATK2=40,Def=0.05,SDef=1,Dodge=0.25,Crit=0.1,Career=CAREER_TYPE_DPS}}return bl end}a["Game/GameObjects/UnitAttr"]={inited=false,cached=false,loader=function(...)local b4=b("Common/IDGenerator")local bF=b4.New()local bd={Strength=bF:Next(),Agility=bF:Next(),Intelligence=bF:Next(),Life=bF:Next(),Mana=bF:Next(),Power=bF:Next(),DamageDealt=bF:Next(),CritRate=bF:Next(),AttackSpeed=bF:Next(),AttackRate=bF:Next(),CDR=bF:Next(),DodgeRate=bF:Next(),PhyxResist=bF:Next(),PhyxDef=bF:Next(),SpellResist=bF:Next(),SpellDef=bF:Next(),PhyxCritTaken=bF:Next(),SpellCritTaken=bF:Next(),DamageTaken=bF:Next(),LifeRegen=bF:Next(),ManaRegen=bF:Next(),Speed=bF:Next(),Absorb=bF:Next(),LifeLeech=bF:Next(),ManaLeech=bF:Next()}return bd end}a["Game/Systems/SpellCastSystem"]={inited=false,cached=false,loader=function(...)local aw=b("Game/System")local ay=b("Game/EventCenter")local bG=class("SpellCastSystem",aw)function bG:Awake()ay.SpellCast:AddListener(self.OnSpellCast,self)end;function bG:OnSpellCast(bH,bI)log(GetUnitName(bH).." cast "..bI)end;return bG end}a["Main"].loader()
--nef-inject-end
end

function config()
    SetMapName("TRIGSTR_001")
    SetMapDescription("TRIGSTR_003")
    SetPlayers(1)
    SetTeams(1)
    SetGamePlacement(MAP_PLACEMENT_USE_MAP_SETTINGS)
    DefineStartLocation(0, 576.0, -576.0)
    InitCustomPlayerSlots()
    SetPlayerSlotAvailable(Player(0), MAP_CONTROL_USER)
    InitGenericPlayerSlots()
end

