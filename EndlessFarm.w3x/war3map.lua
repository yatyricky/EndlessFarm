function InitGlobals()
end

function CreateAllItems()
    local itemID
    BlzCreateItemWithSkin(FourCC("ckng"), 199.3, -390.7, FourCC("ckng"))
    BlzCreateItemWithSkin(FourCC("prvt"), 179.3, -205.3, FourCC("prvt"))
end

function InitCustomPlayerSlots()
    SetPlayerStartLocation(Player(0), 0)
    SetPlayerColor(Player(0), ConvertPlayerColor(0))
    SetPlayerRacePreference(Player(0), RACE_PREF_HUMAN)
    SetPlayerRaceSelectable(Player(0), true)
    SetPlayerController(Player(0), MAP_CONTROL_USER)
end

function InitCustomTeams()
    SetPlayerTeam(Player(0), 0)
end

function main()
    SetCameraBounds(-3328.0 + GetCameraMargin(CAMERA_MARGIN_LEFT), -3584.0 + GetCameraMargin(CAMERA_MARGIN_BOTTOM), 3328.0 - GetCameraMargin(CAMERA_MARGIN_RIGHT), 3072.0 - GetCameraMargin(CAMERA_MARGIN_TOP), -3328.0 + GetCameraMargin(CAMERA_MARGIN_LEFT), 3072.0 - GetCameraMargin(CAMERA_MARGIN_TOP), 3328.0 - GetCameraMargin(CAMERA_MARGIN_RIGHT), -3584.0 + GetCameraMargin(CAMERA_MARGIN_BOTTOM))
    SetDayNightModels("Environment\\DNC\\DNCLordaeron\\DNCLordaeronTerrain\\DNCLordaeronTerrain.mdl", "Environment\\DNC\\DNCLordaeron\\DNCLordaeronUnit\\DNCLordaeronUnit.mdl")
    NewSoundEnvironment("Default")
    SetAmbientDaySound("LordaeronSummerDay")
    SetAmbientNightSound("LordaeronSummerNight")
    SetMapMusic("Music", true, 0)
    CreateAllItems()
    InitBlizzard()
    InitGlobals()
--nef-inject
local a={}local b=function(c)local d=a[c]if d~=nil then if not d.inited then d.cached=d.loader()d.inited=true end;return d.cached else error("module not found")return nil end end;a["Main"]={inited=false,cached=false,loader=function(...)b("Extension")b("Game/Configs/Const")b("GlobalFuncs")b("Logger")b("Time").Init()b("Locale/Locale").Init("EN")b("Game/Engine").Start()end}a["Extension"]={inited=false,cached=false,loader=function(...)n_floor=math.floor;n_min=math.min;n_max=math.max;function n_clamp(e,f,g)return n_min(n_max(e,f),g)end;function n_round(e)return n_floor(e+0.5)end;function t_join(h,i,j)local k=""for l=1,#h do if j then k=k..j(h[l])else k=k..tostring(h[l])end;if l<#h then k=k..i end end;return k end;function t_isempty(h)return next(h)==nil end;function t_tojson(h,m)local function n(o)local p=type(o)if p=="string"then return'"'..o..'"'end;local q=tostring(o)if p=="function"then return'"'..q..'"'else return q end end;local function r(h,s,t,u)if type(h)~="table"then return n(h)end;u=u or{}local v=tostring(h)if u[v]then return'"_ ref '..v..'"'end;u[v]=true;local w="{"if s then w=w.."\n"end;local x=s or""local y=m or""local z=s and x..y or nil;local A=s and" "or""w=w..x..'"_ ":'..A..'"'..v..'"'for B,C in pairs(h)do if s then w=w..",\n"else w=w..","end;local D;if type(B)=="number"then D="_ "..B else D=tostring(B)end;w=w..x..'"'..D..'":'..A..r(C,z,s,u)end;if s then w=w.."\n"..(t or"")end;w=w.."}"return w end;return r(h,m)end;function t_query(E,F)F=F or{}local G=F.select;local H=F.where;local I=F.any;local J=F.all;local K=F.sort;local L=F.asList or K~=nil;local M=nil;local function N(E)local O={v=E,l=nil,r=nil}if M==nil then M=O else local P=M;local Q;local R=true;while P~=nil do Q=P;if K(E,P.v)then P=P.l;R=true else P=P.r;R=false end end;if R then Q.l=O else Q.r=O end end end;local S=G or I==nil and J==nil;local T={}local U;local V;for B,C in pairs(E)do if H then if H(B,C)then if S then if L then U=#T+1 else U=B end;if G then V=G(B,C)else V=C end;if K then N(V)end;T[U]=V else if I then if I(B,C)then return true end elseif J then if not J(B,C)then return false end end end end else if S then if L then U=#T+1 else U=B end;if G then V=G(B,C)else V=C end;if K then N(V)end;T[U]=V else if I then if I(B,C)then return true end elseif J then if not J(B,C)then return false end end end end end;if S then if K then local W={}local function X(Y)if Y==nil then return end;X(Y.l)W[#W+1]=Y.v;X(Y.r)end;X(M)return W else return T end else if I then return false elseif J then return true end end end;t_insert=table.insert;function s_split(v,Z)if Z==nil then Z="%s"end;local h={}for v in string.gmatch(v,"([^"..Z.."]+)")do t_insert(h,v)end;return h end end}a["Game/Configs/Const"]={inited=false,cached=false,loader=function(...)ATT_STR=1;ATT_AGI=2;ATT_INT=3;ATT_NON=4;CAREER_TYPE_TANK=32;CAREER_TYPE_HEALER=2;CAREER_TYPE_DPS=4;CAREER_TYPE_MINION=64;CAREER_TYPE_BOSS=8;CAREER_TYPE_CREEP=16;ABILITY_Q=1093681456ABILITY_W=1093681457ABILITY_E=1093681458ABILITY_R=1093681459ABILITY_D=1093681460ABILITY_F=1093681461UTID_BLADE_MASTER=1331850337 end}a["GlobalFuncs"]={inited=false,cached=false,loader=function(...)function clone(_)local a0={}local function a1(_)if type(_)~="table"then return _ elseif a0[_]then return a0[_]end;local a2={}a0[_]=a2;for U,V in pairs(_)do a2[a1(U)]=a1(V)end;return setmetatable(a2,getmetatable(_))end;return a1(_)end;function class(a3,a4)local a5=type(a4)local a6;if a5~="function"and a5~="table"then a5=nil;a4=nil end;if a5=="function"or a4 and a4.__ctype==1 then a6={}if a5=="table"then for B,C in pairs(a4)do a6[B]=C end;a6.__create=a4.__create;a6.super=a4 else a6.__create=a4 end;a6.Constructor=function()end;a6.__cname=a3;a6.__ctype=1;function a6.New(...)local a7=a6.__create(...)for B,C in pairs(a6)do a7[B]=C end;a7.class=a6;a7:Constructor(...)return a7 end else if a4 then a6=clone(a4)a6.super=a4 else a6={Constructor=function()end}end;a6.__cname=a3;a6.__ctype=2;a6.__index=a6;function a6.New(...)local a7=setmetatable({},a6)a7.class=a6;a7:Constructor(...)return a7 end end;return a6 end;function bindfunc(a8,a9)return function(...)return a8(a9,...)end end end}a["Logger"]={inited=false,cached=false,loader=function(...)local aa=b("Time")local function ab(ac,...)local w=""for ad,C in pairs({...})do w=w.." "..t_tojson(C)end;BJDebugMsg(aa.GetTime().."["..ac.."]:"..w)end;function log(...)ab("I")end;function logwarn(...)ab("W")end;function logerror(...)ab("E")end end}a["Time"]={inited=false,cached=false,loader=function(...)local aa={}local ae=100;function aa.Init()aa.clock=CreateTimer()aa.time=0;TimerStart(aa.clock,ae,true,function()aa.time=aa.time+ae end)end;function aa.GetTime()return aa.time+TimerGetElapsed(aa.clock)end;function aa.GetTimeHMS()local af=aa.GetTime()local h={}local ag=math.floor(af)af=af-ag;h.h=math.floor(ag/3600)ag=ag-h.h*3600;h.m=math.floor(ag/60)ag=ag-h.m*60;h.s=ag+af;return h end;return aa end}a["Locale/Locale"]={inited=false,cached=false,loader=function(...)local ah={}function ah.Init(ai)if ai=="EN"then ah.lang=b("Locale/EN")elseif ai=="ZHCN"then ah.lang=b("Locale/EN")end end;function ah.S(U)local T=ah.lang[U]if T then return T else logerror("Lang undefined "..U)return""end end;return ah end}a["Locale/EN"]={inited=false,cached=false,loader=function(...)return{skill_cleave_name="Cleave",skill_cleave_desc="Damage all front enemies."}end}a["Game/Engine"]={inited=false,cached=false,loader=function(...)local aa=b("Time")local aj=b("Timer")local ak=b("Game/World")local al={}function al.Start()local am=ak.New()am:Add(b("Game/Systems/TestSystem").New())am:Add(b("Game/Systems/InputSystem").New())am:Add(b("Game/Systems/CreateUnitSystem").New())am:Add(b("Game/Systems/SpellCastSystem").New())am:Awake()am:Start()local an=aa.GetTime()local ao=aj.New(0.01666667,-1,function()local ap=aa.GetTime()am:Update(ap-an)an=ap end):Start()al.world=am end;return al end}a["Timer"]={inited=false,cached=false,loader=function(...)local aj=class("Timer")aj.refs={}function aj.Update()local aq=aj.refs[GetExpiredTimer()]if aq.this then aq.callback(aq.this)else aq.callback()end;aq.cloop=aq.cloop-1;if aq.cloop<=0 and aq.loop~=-1 then aj.Destroy(aq)end end;function aj:Constructor(ar,as,at,aq)self.interval=ar;self.loop=as;self.cloop=self.loop;self.callback=at;self.this=aq;self.nTimer=CreateTimer()aj.refs[self.nTimer]=self end;function aj:Start()TimerStart(self.nTimer,self.interval,true,aj.Update)return self end;function aj:Extend(V,au)au=au or false;local k=V;if not au then k=math.floor(V/self.interval)end;self.cloop=self.cloop+k end;function aj:Pause()end;function aj:Resume()end;function aj:Destroy()aj.refs[self.nTimer]=nil;DestroyTimer(self.nTimer)end;return aj end}a["Game/World"]={inited=false,cached=false,loader=function(...)local ak=class("World")function ak:Constructor()self:Init()end;function ak:Init()self.systems={}self.time=0;self.frame=0 end;function ak:Add(av)t_insert(self.systems,av)end;function ak:Awake()for ad,C in pairs(self.systems)do C:Awake()end end;function ak:Start()for ad,C in pairs(self.systems)do C:Start()end end;function ak:Update(aw)self.frame=self.frame+1;self.time=self.time+aw;for ad,C in pairs(self.systems)do C:Update(aw)end end;return ak end}a["Game/Systems/TestSystem"]={inited=false,cached=false,loader=function(...)local ax=b("Game/System")local aj=b("Timer")local ay=b("Math/Vector2")local az=class("TestSystem",ax)function az:Awake()end;function az:Start()log("Test system is run")end;function az:Update(aA)end;return az end}a["Game/System"]={inited=false,cached=false,loader=function(...)local ax=class("System")function ax:Awake()end;function ax:Start()end;function ax:Update(aw)end;return ax end}a["Math/Vector2"]={inited=false,cached=false,loader=function(...)local aB=math.sqrt;local aC=math.acos;local aD=math.max;local ay={}ay.__index=ay;ay.__div=function(aE,aF)return setmetatable({x=aE.x/aF,y=aE.y/aF},ay)end;ay.__mul=function(f,aF)if type(aF)=="number"then return setmetatable({x=f.x*aF,y=f.y*aF},ay)else return setmetatable({x=f*aF.x,y=f*aF.y},ay)end end;ay.__add=function(f,g)return setmetatable({x=f.x+g.x,y=f.y+g.y},ay)end;ay.__sub=function(f,g)return setmetatable({x=f.x-g.x,y=f.y-g.y},ay)end;ay.__unm=function(C)return setmetatable({x=-C.x,y=-C.y},ay)end;ay.__eq=function(f,g)return(f.x-g.x)^2+(f.y-g.y)^2<9.999999e-11 end;function ay.New(aG,aH)return setmetatable({x=aG or 0,y=aH or 0},ay)end;function ay:ToString()return string.format("(%f,%f)",self.x,self.y)end;function ay.Normalize(C)local aG=C.x;local aH=C.y;local aI=aB(aG*aG+aH*aH)if aI>0.00000001 then aG=aG/aI;aH=aH/aI else aG=0;aH=0 end;return setmetatable({x=aG,y=aH},ay)end;function ay.Dot(aJ,aK)return aJ.x*aK.x+aJ.y*aK.y end;function ay.Angle(aL,p)local aM,aN=aL.x,aL.y;local aF=aB(aM*aM+aN*aN)if aF>0.00000001 then aM=aM/aF;aN=aN/aF else aM,aN=0,0 end;local aO,aP=p.x,p.y;aF=aB(aO*aO+aP*aP)if aF>0.00000001 then aO=aO/aF;aP=aP/aF else aO,aP=0,0 end;aF=aM*aO+aN*aP;if aF<-1 then aF=-1 elseif aF>1 then aF=1 end;return aC(aF)*57.29578 end;function ay.Magnitude(C)return aB(C.x*C.x+C.y*C.y)end;function ay.Reflect(aQ,aR)local aS=aQ.x;local aT=aQ.y;local aU=aR.x;local aV=aR.y;local aW=-2*(aS*aU+aT*aV)return setmetatable({x=aW*aU+aS,y=aW*aV+aT},ay)end;function ay.Distance(f,g)return aB((f.x-g.x)^2+(f.y-g.y)^2)end;function ay.Lerp(f,g,h)if h<0 then h=0 elseif h>1 then h=1 end;return setmetatable({x=f.x+(g.x-f.x)*h,y=f.y+(g.y-f.y)*h},ay)end;function ay.LerpUnclamped(f,g,h)return setmetatable({x=f.x+(g.x-f.x)*h,y=f.y+(g.y-f.y)*h},ay)end;function ay.MoveTowards(aX,aY,aZ)local a_=aX.x;local b0=aX.y;local aG=aY.x-a_;local aH=aY.y-b0;local aW=aG*aG+aH*aH;if aW>aZ*aZ and aW~=0 then aW=aZ/aB(aW)return setmetatable({x=a_+aG*aW,y=b0+aH*aW},ay)end;return setmetatable({x=aY.x,y=aY.y},ay)end;function ay.ClampMagnitude(C,b1)local aG=C.x;local aH=C.y;local b2=aG*aG+aH*aH;if b2>b1*b1 then local b3=b1/aB(b2)aG=aG*b3;aH=aH*b3;return setmetatable({x=aG,y=aH},ay)end;return setmetatable({x=aG,y=aH},ay)end;function ay.Max(f,g)return setmetatable({x=math.max(f.x,g.x),y=math.max(f.y,g.y)},ay)end;function ay.Min(f,g)return setmetatable({x=math.min(f.x,g.x),y=math.min(f.y,g.y)},ay)end;function ay.Scale(f,g)return setmetatable({x=f.x*g.x,y=f.y*g.y},ay)end;function ay:Set(aG,aH)self.x=aG or 0;self.y=aH or 0;return self end;function ay:Clone()return setmetatable({x=self.x,y=self.y},ay)end;function ay:Div(aF)self.x=self.x/aF;self.y=self.y/aF;return self end;function ay:Mul(aF)self.x=self.x*aF;self.y=self.y*aF;return self end;function ay:Add(g)self.x=self.x+g.x;self.y=self.y+g.y;return self end;function ay:Sub(g)self.x=self.x-g.x;self.y=self.y-g.y;return self end;function ay:SetNormalize()local aI=aB(self.x*self.x+self.y*self.y)if aI>0.00000001 then self.x=self.x/aI;self.y=self.y/aI else self.x=0;self.y=0 end;return self end;function ay:SqrMagnitude()return self.x*self.x+self.y*self.y end;return ay end}a["Game/Systems/InputSystem"]={inited=false,cached=false,loader=function(...)local ax=b("Game/System")local b4=b("Game/EventCenter")local b5=class("InputSystem",ax)function b5.NativeKeyEventZ()b4.Keyboard:Broadcast(OSKEY_Z)end;function b5.NativeKeyEventX()b4.Keyboard:Broadcast(OSKEY_X)end;function b5:Awake()local b6=CreateTrigger()BlzTriggerRegisterPlayerKeyEvent(b6,Player(0),OSKEY_Z,0,true)TriggerAddAction(b6,b5.NativeKeyEventZ)b6=CreateTrigger()BlzTriggerRegisterPlayerKeyEvent(b6,Player(0),OSKEY_X,0,true)TriggerAddAction(b6,b5.NativeKeyEventX)end;return b5 end}a["Game/EventCenter"]={inited=false,cached=false,loader=function(...)local b7=b("Common/IDGenerator")local b8=b("Event")local b9=b7.New()return{SpellCast=b8.New(b9:Next()),Keyboard=b8.New(b9:Next())}end}a["Common/IDGenerator"]={inited=false,cached=false,loader=function(...)local b7=class("IDGenerator")function b7:Constructor(ba)self.start=ba or 0 end;function b7:Next()self.start=self.start+1;return self.start end;return b7 end}a["Event"]={inited=false,cached=false,loader=function(...)local b8=class("Event")function b8:Constructor(b9)self.id=b9;self.handlers={}end;function b8:AddListener(bb,a9)if self.handlers[bb]then logwarn("double AddListener ",self.id,bb,a9)end;self.handlers[bb]=a9 or false end;function b8:RemoveListener(bb)if bb then if not self.handlers[bb]then logwarn("no hander in event ",self.id,bb)end;self.handlers[bb]=nil else self.handlers={}end end;function b8:Broadcast(...)local bc=0;for bb,a9 in pairs(self.handlers)do if a9 then bb(a9,...)else bb(...)end;bc=bc+1 end;if bc==0 then log("event "..self.id.." has no listener")end end;return b8 end}a["Game/Systems/CreateUnitSystem"]={inited=false,cached=false,loader=function(...)local ax=b("Game/System")local bd=b("Game/Managers/UnitManager")local ay=b("Math/Vector2")local aj=b("Timer")local be=class("CreateUnitSystem",ax)function be:Awake()end;function be:Start()log("CreateUnitSystem system started")local bf=bd.CreateUnit(Player(0),UTID_BLADE_MASTER)log("maxhp",BlzGetUnitMaxHP(bf.n_unit))local ao=aj.New(5,1,function()log("set hp")end):Start()end;function be:Update(aA)end;return be end}a["Game/Managers/UnitManager"]={inited=false,cached=false,loader=function(...)local ay=b("Math/Vector2")local bg=b("Game/GameObjects/Unit")local bh=b("Game/GameObjects/UnitAttr")local bd={}function bd.CreateUnit(bi,bj,bk,bl)bk=bk or ay.New()bl=bl or 0;local bf=CreateUnit(bi,bj,bk.x,bk.y,bl)return bg.New(bj,bf)end;return bd end}a["Game/GameObjects/Unit"]={inited=false,cached=false,loader=function(...)local bm=b("Game/Configs/UnitConfig")local bh=b("Game/GameObjects/UnitAttr")local bn={[bh.Strength]={neg={},pos={1093677104,1093677105,1093677106,1093677107,1093677108,1093677109,1093677110,1093677111,1093677112,1093677113,1093677121,1093677122,1093677123}},[bh.Agility]={neg={},pos={1093677104,1093677105,1093677106,1093677107,1093677108,1093677109,1093677110,1093677111,1093677112,1093677113,1093677121,1093677122,1093677123}},[bh.Intelligence]={neg={},pos={1093677104,1093677105,1093677106,1093677107,1093677108,1093677109,1093677110,1093677111,1093677112,1093677113,1093677121,1093677122,1093677123}}}local bg=class("Unit")function bg:Constructor(bj,bo)self.n_unit=bo;self.config=bm.ById[bj]self.attrs={}self.attrGet={}self.attrSet={}self.attrRet={}self.attrMod={}self.skillList={}self:_InitAttribute(bh.Strength,nil,function(V)self.attrs[bh.Strength]=V;self:_SetNativeAttr(bh.Strength,V)end,function(bp)return GetHeroStr(self.n_unit,not bp)end,function(V)self.attrs[bh.Strength]=self.attrs[bh.Strength]+V;self:_SetNativeAttr(bh.Strength,self.attrs[bh.Strength])end)self:_InitAttribute(bh.Agility,nil,function(V)self.attrs[bh.Agility]=V;self:_SetNativeAttr(bh.Agility,V)end,function(bp)return GetHeroAgi(self.n_unit,not bp)end,function(V)self.attrs[bh.Agility]=self.attrs[bh.Agility]+V;self:_SetNativeAttr(bh.Agility,self.attrs[bh.Agility])end)self:_InitAttribute(bh.Intelligence,nil,function(V)self.attrs[bh.Intelligence]=V;self:_SetNativeAttr(bh.Intelligence,V)end,function(bp)return GetHeroInt(self.n_unit,not bp)end,function(V)self.attrs[bh.Intelligence]=self.attrs[bh.Intelligence]+V;self:_SetNativeAttr(bh.Intelligence,self.attrs[bh.Intelligence])end)self:_InitAttribute(bh.Life,function(bp)if bp then return self.config.HP else return self.attrs[bh.Life]end end,function(V)self.attrs[bh.Life]=V;self:_SetNativeAttr(bh.Life,self.attrs[bh.Life]-1)end,function(bp)if bp then return self.config.HP+GetHeroStr(self.n_unit,true)*10 else return GetUnitState(self.n_unit,UNIT_STATE_MAX_LIFE)end end,function(V)self.attrs[bh.Life]=self.attrs[bh.Life]+V;self:_SetNativeAttr(bh.Life,self.attrs[bh.Life]-1)end)self:_InitAttribute(bh.Mana,function(bp)if bp then return self.config.MP else return self.attrs[bh.Mana]end end,function(V)self.attrs[bh.Mana]=V;self:_SetNativeAttr(bh.Mana,self.attrs[bh.Mana])end,function(bp)if bp then return self.config.MP+GetHeroInt(self.n_unit,true)*10 else return GetUnitState(self.n_unit,UNIT_STATE_MAX_MANA)end end,function(V)self.attrs[bh.Mana]=self.attrs[bh.Mana]+V;self:_SetNativeAttr(bh.Mana,self.attrs[bh.Mana])end)self:_InitAttribute(bh.Power,nil,function(V)self.attrs[bh.Power]=V;self:_SetNativeAttr(bh.Power,self.attrs[bh.Power])end,function()local bq=self.config;local br=self.attrs[bh.Power]+math.random(bq.ATK1,bq.ATK2)return br+self:GetMainAttrValue()end,function(V)self.attrs[bh.Power]=self.attrs[bh.Power]+V;self:_SetNativeAttr(bh.Power,self.attrs[bh.Power])end)self:_InitAttribute(bh.DamageDealt,nil,nil,function()return n_max(self.attrs[bh.DamageDealt],0)end,nil)self:_InitAttribute(bh.CritRate,nil,nil,function()return n_min(self.attrs[bh.CritRate],1)end)self:_InitAttribute(bh.AttackSpeed,nil,function(V)self.attrs[bh.AttackSpeed]=V;self:_SetNativeAttr(bh.AttackSpeed,n_round(V*100))end,nil,function(V)self.attrs[bh.AttackSpeed]=self.attrs[bh.AttackSpeed]+V;self:_SetNativeAttr(bh.AttackSpeed,n_round(self.attrs[bh.AttackSpeed]*100))end)self:_InitAttribute(bh.AttackRate,nil,nil,function()return n_clamp(self.attrs[bh.AttackRate],0.25,1)end,nil)self:_InitAttribute(bh.SpellCDR,nil,function()end,nil)self:_InitAttribute(bh.DodgeRate,nil,nil,function()local T=self.attrs[bh.DodgeRate]+GetHeroAgi(self.n_unit,true)*0.002;return n_min(T,0.75)end)self:_InitAttribute(bh.PhyxResist,function(bp)if bp then return self.config.Def else return self.config.Def+self.attrs[bh.PhyxResist]end end,function(V)self.attrs[bh.PhyxResist]=V;self:_SetNativeAttr(bh.PhyxResist,n_round(self.attrs[bh.PhyxResist]*100))end,nil,function(V)self.attrs[bh.PhyxResist]=self.attrs[bh.PhyxResist]+V;self:_SetNativeAttr(bh.PhyxResist,n_round(self.attrs[bh.PhyxResist]*100))end)self:_InitAttribute(bh.PhyxDef,nil,nil,nil,nil)self:_InitAttribute(bh.SpellResist,nil,nil,nil,nil)self:_InitAttribute(bh.SpellDef,nil,nil,nil,nil)self:_InitAttribute(bh.PhyxCritTaken,nil,nil,nil,nil)self:_InitAttribute(bh.SpellCritTaken,nil,nil,nil,nil)self:_InitAttribute(bh.DamageTaken,nil,nil,function()return n_max(self.attrs[bh.DamageTaken],0)end,nil)self:_InitAttribute(bh.LifeRegen,nil,nil,nil,nil)self:_InitAttribute(bh.ManaRegen,nil,nil,nil,nil)self:_InitAttribute(bh.Speed,function()return GetUnitMoveSpeed(self.n_unit)end,function(V)end,nil)self:_InitAttribute(bh.Absorb,nil,nil,nil)self:_InitAttribute(bh.LifeLeech,nil,nil,nil)self:_InitAttribute(bh.ManaLeech,nil,nil,nil)self:_InitWithConfig()end;function bg:_SetNativeAttr(bs,V)local Q=self:GetAttr(bs)if Q==V then return end;self:SetAttr(bs,V)local bf=self.n_unit;local bt=bn[bs]local bu=bt.neg;local bk=bt.pos;V=n_clamp(V,2^#bu-1,2^#bk-1)local function bv(bw)for l=1,#bw do local bx=bw[l]if GetUnitAbilityLevel(bf,bx)>0 then UnitRemoveAbility(bf,bx)end end end;local function by(bw,C)local bz=1;for l=1,#bw do local bx=bw[l]local bA=BlzBitAnd(C,bz)==bz;local bB=GetUnitAbilityLevel(bf,bx)>0;if bA and not bB then UnitAddAbility(bf,bx)UnitMakeAbilityPermanent(bf,true,bx)end;if not bA and bB then UnitRemoveAbility(bf,bx)end;bz=bz*2 end end;if V==0 then bv(bu)bv(bk)else if V<0 then bv(bk)by(bu,math.abs(V))else bv(bu)by(bk,V)end end end;function bg:_InitAttribute(bs,bC,bD,bE,bF)self.attrs[bs]=0;bC=bC or function()return self.attrs[bs]end;bD=bD or function(V)self.attrs[bs]=V end;bE=bE or bC;bF=bF or function(V)bD(bC()+V)end;self.attrGet[bs]=bC;self.attrSet[bs]=bD;self.attrRet[bs]=bE;self.attrMod[bs]=bF end;function bg:_InitWithConfig()end;function bg:GetAttr(bs,...)return self.attrGet[bs](...)end;function bg:SetAttr(bs,V)self.attrSet[bs](V)end;function bg:ReturnAttr(bs,...)self.attrRet[bs](...)end;function bg:ModAttr(bs,V)self.attrMod[bs](V)end;function bg:GetMainAttrValue()if self.unitConfig.mainAtt==ATT_STR then return GetHeroStr(self.n_unit,true)elseif self.unitConfig.mainAttribute==ATT_AGI then return GetHeroAgi(self.n_unit,true)elseif self.unitConfig.mainAttribute==ATT_INT then return GetHeroInt(self.n_unit,true)end;return 0 end;function bg:ReturnPhyxPowerMax()return self.config.ATK2+self:GetMainAttrValue()end;return bg end}a["Game/Configs/UnitConfig"]={inited=false,cached=false,loader=function(...)local bm={}bm.DB={{UTID=UTID_BLADE_MASTER,MainAtt=ATT_STR,HP=3000,MP=200,ATK1=50,ATK2=100,Def=0.1,SDef=1,Dodge=0.25,Crit=0.1,Career=CAREER_TYPE_DPS}}local bG={}for ad,C in pairs(bm.DB)do bG[C.UTID]=C end;bm.ById=setmetatable(bG,{__index=function(h,B)local C=rawget(h,B)if C then return C else logerror("id not found "..B)end end})return bm end}a["Game/GameObjects/UnitAttr"]={inited=false,cached=false,loader=function(...)local b7=b("Common/IDGenerator")local bH=b7.New()local bh={Strength=bH:Next(),Agility=bH:Next(),Intelligence=bH:Next(),Life=bH:Next(),Mana=bH:Next(),Power=bH:Next(),DamageDealt=bH:Next(),CritRate=bH:Next(),AttackSpeed=bH:Next(),AttackRate=bH:Next(),CDR=bH:Next(),DodgeRate=bH:Next(),PhyxResist=bH:Next(),PhyxDef=bH:Next(),SpellResist=bH:Next(),SpellDef=bH:Next(),PhyxCritTaken=bH:Next(),SpellCritTaken=bH:Next(),DamageTaken=bH:Next(),LifeRegen=bH:Next(),ManaRegen=bH:Next(),Speed=bH:Next(),Absorb=bH:Next(),LifeLeech=bH:Next(),ManaLeech=bH:Next()}return bh end}a["Game/Systems/SpellCastSystem"]={inited=false,cached=false,loader=function(...)local ax=b("Game/System")local b4=b("Game/EventCenter")local bI=class("SpellCastSystem",ax)function bI:Awake()b4.SpellCast:AddListener(self.OnSpellCast,self)end;function bI:OnSpellCast(bJ,bK)log(GetUnitName(bJ).." cast "..bK)end;return bI end}a["Main"].loader()
--nef-inject-end
end

function config()
    SetMapName("TRIGSTR_001")
    SetMapDescription("TRIGSTR_003")
    SetPlayers(1)
    SetTeams(1)
    SetGamePlacement(MAP_PLACEMENT_USE_MAP_SETTINGS)
    DefineStartLocation(0, 576.0, -576.0)
    InitCustomPlayerSlots()
    SetPlayerSlotAvailable(Player(0), MAP_CONTROL_USER)
    InitGenericPlayerSlots()
end

